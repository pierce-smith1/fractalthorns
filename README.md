# fractalthorns

[Visit the live site!](https://fractalthorns.com/)

fractalthorns is my personal site and a nexus of the artwork, writing, and other things I do. It is the successor to [doughbyte.com](https://doughbyte.com).

fractalthorns is an [Astro](https://astro.build/) site with a frontend in Svelte. It is designed around showcasing static content and reads this content directly from the filesystem. Content is served over an API which is effectively private but is still open for public use. Please get in touch with me if you're interested in using the API to make your own apps using fractalthorn's content.

## Does this repo contain spoilers for the fractalthorns story?

No! There is no _content_ in this repo, only code, so none of the story or image descriptions or anything is hiding in here. Browse to your heart's content.

## Will you accept contributions?

Sure! I have no specific requirements for process or anything like that, just go ahead and PR me.

### How do I get set up locally?

The only software required is Node.js and NPM. The project has been tested extensively with Node 20 + NPM 10 on Windows 10. Mileage on other operating systems and with other versions of Node may vary.

To get a local server going, the first thing you'll need is a content folder. A sample folder is provided as `_samplecontent` in this repo, which contains a subset of the content on the live site.

Next, you'll need to create a file called `rvaenv` and in it, define four environment variables for the server:
* `RVA_SELF_URL`: The URL the site will be served on, locally this should be `localhost:4321`
* `RVA_AUTHORLAND_ROOT`: The path to the static content directory, for the sample folder this is `_samplecontent/authorland`
* `RVA_READERLAND_ROOT`: The path to the dynamic content directory, for the sample folder this is `_samplecontent/readerland`
* `PRIVATE_API_KEY`: (optional) The symmetric key for authenticating a private application that wants to use the mutating POST functions of the API. This should be randomly generated by you in a cryptographically secure way and kept a secret in the server and the private application. This is optional because the server will still run without it and be nearly 100% functional, just the POST endpoints (i.e. submitting splashes and marking records as solved) won't work.

This is what your `rvaenv` might look like (using Windows paths, but this works on Linux the same way):

```
RVA_SELF_URL="http://localhost:4321"
RVA_AUTHORLAND_ROOT="D:/Projects/fractalthorns/_samplecontent/authorland"
RVA_READERLAND_ROOT="D:/Projects/fractalthorns/_samplecontent/readerland"
PRIVATE_API_KEY="<generate a cryptographically random string of characters here>"
```

Then, you can run the local development server with `npm run dev`, which will serve on `localhost:4321`. Note that if a server is already running on 4321 it will _not_ fail fast, it will just pick a different port.

#### Building and deploying

Running locally is sufficient for messing around and contributing, but if you want to deploy the site to an actual
server, read on.

The site can be built for deployment with `npm run build`. When run from the repo root, this will create a folder called `dist` in the repo root which contains a full node.js application to serve the site. To deploy, move the following things to a folder on your server machine:

* `dist`
* `package.json`
* your content folder

Then set up environment variables as described above with values changed for your server. Notably the `RVA_SELF_URL` should change to the URL of your server, e.g. `https://fractalthorns.com`. They don't have to be written to a file called `rvaenv`, you just need to make sure they are in your environment before running the server with `node`.

Finally, run `npm install` and then `node dist/server/entry.mjs` to actually run the server. Again, be sure the environment variables are loaded when running `node`.



